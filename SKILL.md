---
name: adhd-quest
description: ADHD 관리를 RPG 게이미피케이션으로 만든 텔레그램 비서 스킬. 인라인 버튼으로 퀘스트 완료, 감정/감사일기 자동 저장, XP/레벨/스트릭 시스템. Use when managing ADHD routines, sending quest reminders, tracking emotions, or generating weekly reports.
---

# ADHD Quest Skill

ADHD 관리를 RPG로 만든 텔레그램 비서. 모든 조작은 인라인 버튼, 타이핑 최소화.

---

## 온보딩 (첫 실행)

`adhd-config.json`이 workspace에 없으면 온보딩을 시작한다.  
**모든 질문은 텔레그램 인라인 버튼으로 제시한다.** 타이핑은 이름 입력과 직접 경로 입력만.

### Step 1: 이름
```
"안녕하세요! ADHD Quest에 오신 걸 환영합니다 🎮"
"먼저 이름을 알려주세요. (닉네임도 OK)"
```
- 사용자가 텍스트로 입력 → `name`에 저장

### Step 2: 저장 경로
```
"일지를 어디에 저장할까요?"
```
인라인 버튼:
- `📓 Obsidian Vault` → Vault 경로 입력 요청
- `📁 Documents` → `~/Documents/ADHDQuest`
- `✏️ 직접 입력`

### Step 3: 퀘스트 선택
```
"어떤 퀘스트를 활성화할까요? (여러 개 선택 가능)"
"필요 없는 건 나중에 빼도 돼요 💡"
```
인라인 버튼 (토글 방식, 한 줄에 2개):
- `💧 물 마시기` | `💊 약 복용`
- `📝 할 일 쪼개기` | `⏰ 리마인더`
- `😊 감정 체크인` | `🧩 두뇌 덤프`
- `🌅 아침 루틴` | `🙏 감사일기`
- `😴 수면 관리` | `📊 주간 리포트`
- `✅ 선택 완료`

퀘스트 ID 매핑:
- water, meds, chunking, reminder, emotion, braindump, morning, gratitude, sleep, weekly

### Step 4: 알림 시간
```
"아침 알림은 몇 시에 보낼까요?"
```
인라인 버튼 (한 줄 3개):
- `7:00` | `8:00` | `9:00`
- `✏️ 직접 입력`

```
"저녁 알림은요?"
```
- `20:00` | `21:00` | `22:00`
- `✏️ 직접 입력`

### Step 5: 난이도
```
"난이도를 골라주세요! XP 배율이 달라져요 🎯"
```
인라인 버튼:
- `🟢 이지 (×1.0)` | `🟡 노말 (×1.5)` | `🔴 하드 (×2.0)`

### Step 6: 설정 저장 & 크론 등록

**6-1. config 저장**
- `adhd-config.json`을 workspace에 저장 (구조는 `references/adhd-config-example.json` 참고)

**6-2. 크론잡 등록 (cron tool 사용)**

아침 크론 등록:
```json
{
  "action": "add",
  "job": {
    "name": "ADHD Quest 아침",
    "schedule": { "kind": "cron", "expr": "0 {morning_hour} * * *", "tz": "Asia/Seoul" },
    "sessionTarget": "isolated",
    "payload": {
      "kind": "agentTurn",
      "message": "[ADHD Quest 아침 크론] workspace/adhd-config.json을 읽어서 오늘의 아침 퀘스트를 텔레그램 인라인 버튼으로 발송해줘.\n\n규칙:\n1. lastQuestDate가 오늘이면 스킵\n2. 스트릭 계산 (어제와 비교)\n3. config의 quests.morning 항목을 인라인 버튼으로 발송\n4. 버튼 callback_data 형식: quest_{id}_{YYYYMMDD}\n5. 마지막 줄에 '😴 오늘은 여기까지' 버튼 추가\n6. 메시지에 레벨, 칭호, 스트릭 표시\n7. message tool의 buttons 파라미터로 인라인 버튼 발송"
    },
    "delivery": { "mode": "none" }
  }
}
```

저녁 크론 등록:
```json
{
  "action": "add",
  "job": {
    "name": "ADHD Quest 저녁",
    "schedule": { "kind": "cron", "expr": "0 {evening_hour} * * *", "tz": "Asia/Seoul" },
    "sessionTarget": "isolated",
    "payload": {
      "kind": "agentTurn",
      "message": "[ADHD Quest 저녁 크론] workspace/adhd-config.json을 읽고 저녁 루틴 실행:\n\n1. 감정 체크인: 감정 이모지 버튼 발송 (😢1~2 / 😕3~4 / 😐5~6 / 😊7~8 / 😄9~10)\n2. 감사일기: '오늘 감사한 것 하나만' 질문\n3. 오늘 완료율 리포트 발송 (완료 퀘스트 수, 획득 XP, 레벨 진행)\n4. 감정/감사 응답은 {savePath}/일지/ 하위에 마크다운으로 자동 저장\n5. config의 xp, streak, history 업데이트\n6. message tool의 buttons로 인라인 버튼 발송\n7. delivery는 none (직접 message tool로 발송)"
    },
    "delivery": { "mode": "none" }
  }
}
```

일요일 주간 리포트 크론:
```json
{
  "action": "add",
  "job": {
    "name": "ADHD Quest 주간리포트",
    "schedule": { "kind": "cron", "expr": "0 21 * * 0", "tz": "Asia/Seoul" },
    "sessionTarget": "isolated",
    "payload": {
      "kind": "agentTurn",
      "message": "[ADHD Quest 주간리포트] workspace/adhd-config.json과 이번 주 history를 읽고:\n\n1. 일별 완료율, 감정 변화, 감사 모음, 총 XP 집계\n2. {savePath}/일지/주간리포트/YYYY-Www.md에 저장\n3. 텔레그램으로 요약 발송 (완료율, 레벨 변화, 스트릭, 잘한 점)\n4. message tool의 buttons로 [📈 자세히 보기] [🎁 보상 확인] 버튼 추가"
    },
    "delivery": { "mode": "none" }
  }
}
```

**6-3. 완료 메시지**
```
"🎮 설정 완료! Lv.1 🌱 견습생 {name}님의 모험이 시작됩니다!"
"내일 아침 {morning_time}에 첫 퀘스트를 보내드릴게요 ⚔️"
"크론잡 3개 등록 완료: 아침({morning_time}) / 저녁({evening_time}) / 주간(일요일 21:00)"
```

---

## 버튼 콜백 처리 (메인 세션)

사용자가 인라인 버튼을 누르면 메인 세션으로 callback_data가 들어온다.
이 스킬이 설치되어 있으면 메인 세션이 자동으로 참조한다.

### callback_data 규칙
- 퀘스트 완료: `quest_{id}_{YYYYMMDD}` (예: `quest_water_20260218`)
- 감정 체크: `emotion_{score}_{YYYYMMDD}` (예: `emotion_8_20260218`)
- 오늘 패스: `quest_skip_{YYYYMMDD}`

### 콜백 처리 흐름
1. callback_data 파싱 → 날짜, 퀘스트 ID 확인
2. `adhd-config.json` 읽기
3. 해당 퀘스트 완료 처리 + XP 계산 (난이도 배율 적용)
4. 레벨업 체크 → 레벨업 시 축하 메시지
5. config 업데이트 (xp, level, streak, lastQuestDate, history)
6. 응답: "✅ {퀘스트명} 완료! +{xp} XP | Lv.{level} {title} ({current}/{next} XP)"

---

## 크론잡 실행

### 아침 크론

1. `adhd-config.json` 읽기
2. `lastQuestDate`가 오늘이면 스킵
3. 스트릭 계산 (어제 날짜와 비교, 끊겼으면 0으로 리셋)
4. 선택된 아침 퀘스트를 인라인 버튼으로 발송:

```
"🌅 좋은 아침! Lv.{level} {title} {name}님"
"오늘의 퀘스트가 도착했어요 ⚔️"
""
"🔥 스트릭: {streak}일째!" (3일 이상일 때만)
```

인라인 버튼 (퀘스트별, 한 줄에 2~3개):
- 선택된 아침 퀘스트들
- 마지막 줄: `😴 오늘은 여기까지`

5. 버튼 콜백 처리:
   - 퀘스트 버튼 클릭 → 완료 처리, XP 부여, 버튼 텍스트에 ✅ 표시
   - "오늘은 여기까지" → 긍정 메시지 ("내일 다시 만나요! 오늘도 충분히 잘했어요 🌟")
   - 모든 퀘스트 완료 → 올클리어 보너스 + 축하 메시지

### 저녁 크론

1. 감정 체크인 (emotion 퀘스트 활성화 시):
```
"😊 오늘 하루 어땠어요?"
"감정 온도를 골라주세요 🌡️"
```
인라인 버튼:
- `😢 1~2` | `😕 3~4` | `😐 5~6`
- `😊 7~8` | `😄 9~10`

선택 후 → "한 줄로 오늘을 표현한다면?" (텍스트 입력)
→ 감정일기 자동 저장

2. 감사일기 (gratitude 퀘스트 활성화 시):
```
"🙏 오늘 감사한 것 하나만 알려주세요"
```
→ 텍스트 입력 → 감사일기에 append

3. 오늘 완료율 리포트:
```
"📊 오늘의 리포트"
"완료: {done}/{total} 퀘스트"
"획득 XP: +{today_xp}"
"━━━━━━━━━━━━━━━━ {percent}%"
"Lv.{level} {title} → 다음 레벨까지 {remaining} XP"
```

### 일요일 크론 (주간 리포트)

1. 이번 주 데이터 집계:
   - 일별 완료율
   - 감정 변화 추이 (이모지 + 점수)
   - 감사일기 모음
   - 총 획득 XP
   - 스트릭 현황
2. 주간리포트 파일 저장: `{savePath}/일지/주간리포트/YYYY-Www.md`
3. 텔레그램으로 요약 발송
4. 잘한 점 1~2개 하이라이트 + 격려 메시지

---

## RPG 시스템

### XP 규칙

**하루 기본 획득 (올클리어 시):**

| 항목 | 기본 XP |
|------|---------|
| 퀘스트 완료 (개당) | +10 |
| 올클리어 보너스 | +15 |
| 감정 체크인 | +10 |
| 감사일기 | +10 |
| 두뇌 덤프 정리 | +10 |
| **하루 올클리어 합계 (5개 퀘스트 기준)** | **~85** |

### 난이도 보정
- 🟢 이지: ×1.0 (하루 ~85 XP)
- 🟡 노말: ×1.3 (하루 ~110 XP)
- 🔴 하드: ×1.6 (하루 ~136 XP)

최종 XP = 기본 XP × 난이도 배율 (소수점 버림)

### 레벨 시스템 (누적 XP)

레벨업 시 축하 메시지 + 칭호 변경 알림.
**밸런스 기준: 🔴 하드 올클리어 30일 → 🛡️ 마스터 도달**

| 레벨 | 칭호 | 누적 XP | 하드 올클 | 노말 올클 | 이지 올클 |
|------|------|---------|----------|----------|----------|
| 1 | 🌱 견습생 | 0 | 시작 | 시작 | 시작 |
| 2 | 🌿 수련생 | 200 | ~2일 | ~2일 | ~3일 |
| 3 | ⚔️ 전사 | 600 | ~5일 | ~6일 | ~8일 |
| 4 | 🔥 정예 전사 | 1,500 | ~11일 | ~14일 | ~18일 |
| 5 | 🛡️ 마스터 | 3,500 | ~28일 | ~35일 | ~45일 |
| 7 | 🌟 그랜드마스터 | 8,000 | ~60일 | ~75일 | ~100일 |
| 10 | 🏆 전설 | 20,000 | ~150일 | ~190일 | ~240일 |

### 스트릭
- **유지 조건**: 하루에 퀘스트 1개 이상 완료
- **리셋**: 하루라도 0개면 리셋 (단, 비난 금지 → "내일 다시!")
- 보너스:

| 연속 일수 | 보너스 XP |
|-----------|-----------|
| 3일 | +30 |
| 7일 | +70 |
| 14일 | +150 |
| 30일 | +500 |

- 스트릭 보너스는 해당 일수 도달 시 1회 지급

### XP & 레벨 업데이트
- 퀘스트 완료/일기 작성 시마다 `adhd-config.json`의 `xp`, `level`, `streak` 업데이트
- `history` 배열에 `{ "date": "YYYY-MM-DD", "quests": [...], "xp": N }` 추가

---

## 자동 저장 일지

### 감정일기
경로: `{savePath}/일지/감정일기/YYYY-MM-DD.md`

```markdown
---
date: 2026-02-18
emotion: 😊
score: 8
---

# 😊 2026-02-18 감정일기

**감정 온도**: 8/10 😊
**한줄 메모**: 오늘 집중이 잘 됐다

## 오늘의 퀘스트
- ✅ 물 마시기
- ✅ 약 복용
- ✅ 할 일 정리
- ❌ 감사일기

**획득 XP**: +45
**누적**: Lv.3 전사 (273/400 XP)
```

### 감사일기
경로: `{savePath}/일지/감사일기/YYYY-MM-DD.md`

append 방식 (하루에 여러 번 가능):
```markdown
---
date: 2026-02-18
---

# 🙏 2026-02-18 감사일기

- 21:00 — 커피가 맛있었다
- 21:30 — 친구가 연락해줘서 좋았다
```

### 주간 리포트
경로: `{savePath}/일지/주간리포트/YYYY-Www.md`

```markdown
---
week: 2026-W08
period: 2026-02-16 ~ 2026-02-22
---

# 📊 2026-W08 주간 리포트

## 완료율
| 요일 | 완료 | 비율 |
|------|------|------|
| 월 | 4/6 | 67% |
| 화 | 6/6 | 100% 🎉 |
| ... | ... | ... |
| **평균** | | **78%** |

## 감정 변화
월😊8 → 화😄9 → 수😐5 → 목😊7 → 금😊8 → 토😄9 → 일😊8

## 감사 모음
- 커피가 맛있었다
- 친구가 연락해줘서 좋았다
- ...

## 이번 주 잘한 점
- 7일 스트릭 달성! 🔥
- 올클리어 2회 달성

## 통계
- 총 획득 XP: +320
- 레벨: Lv.3 → Lv.4 (승급!)
- 스트릭: 12일째
```

---

## 특수 반응

사용자 메시지에 특정 키워드가 감지되면 반응한다.

### "힘들어" / "불안해" / "우울해"
```
"괜찮아요, {name}님. 지금 이 순간도 충분히 잘하고 있어요 💜"
"잠깐 호흡 한 번 해볼까요?"
```
인라인 버튼:
- `🫁 호흡 가이드 (4-7-8)` | `💬 그냥 들어줘`
- `😴 오늘은 쉴래요`

호흡 가이드 선택 시:
```
"🫁 4-7-8 호흡법"
"1. 코로 4초 들이쉬고..."
"2. 7초 참고..."  
"3. 입으로 8초 내쉬기..."
"3번 반복해보세요. 기다릴게요 🕊️"
```

### "할 일 정리" / "뭐 해야 하지"
퀘스트 보드 형태로 표시:
```
"📋 퀘스트 보드"
""
"🔴 긴급"
"  • 약 복용 (미완료)"
""
"🟡 오늘"
"  • 물 마시기"  
"  • 할 일 정리"
""
"🟢 여유"
"  • 감사일기"
```

### "다 했어" / "끝났어"
```
"🎉 대단해요! 올클리어! +25 XP"
""
"━━━━━━━━━━━━━━━━ 73%"
"Lv.3 전사 → Lv.4 까지 27 XP"
""
"오늘의 {name}님은 진짜 멋져요 ✨"
```

### "미루고 있어" / "시작을 못하겠어"
```
"시작이 제일 어렵죠. 딱 하나만 해볼까요?"
"가장 쉬운 거 하나 골라봤어요 👇"
```
인라인 버튼:
- `💧 물 한 잔 마시기 (2분)` ← 미완료 중 가장 쉬운 것
- `😴 오늘은 패스`

### "설정 바꿔줘"
설정 변경 메뉴:
인라인 버튼:
- `🎯 퀘스트 변경` | `⏰ 시간 변경`
- `🎮 난이도 변경` | `📂 경로 변경`

---

## 버튼 UI 규칙

1. **모든 선택지는 인라인 버튼** — 타이핑 최소화
2. **한 줄에 2~3개까지** — 너무 많으면 ADHD에 역효과
3. **"오늘은 여기까지" 옵션 항상 제공** — 도망칠 수 있어야 함
4. **완료/미완료 모두 긍정적 반응** — 죄책감 유발 금지
5. 미완료 시: "내일 다시 만나요! 오늘도 충분히 잘했어요 🌟"
6. 완료 시: "멋져요! +{xp} XP ✨"

---

## 데이터 관리

### adhd-config.json 위치
workspace 루트 (`~/.openclaw/workspace/adhd-config.json`)

### 일지 저장 위치
사용자가 온보딩에서 선택한 `savePath` 하위:
- `{savePath}/일지/감정일기/`
- `{savePath}/일지/감사일기/`
- `{savePath}/일지/주간리포트/`

폴더가 없으면 자동 생성 (`mkdir -p`).

### 백업
`adhd-config.json`의 `history` 배열에 일별 기록이 축적된다.
주간 리포트는 마크다운 파일로 영구 보존된다.

---

## 의학적 근거

각 기능의 근거는 `references/adhd-research.md`에 정리되어 있다.  
주요 참고:
1. Task Chunking — CBT 실행기능 강화
2. Externalization — 작업기억 보완
3. 감정 조절 — CBT 유의미 향상
4. 게이미피케이션 — 도파민 보상경로 활용
5. 실행기능 외주화 — AI 도구 (ADDA 권장)
6. 환경 구조화 — 유혹 저항 대신 환경 통제
7. 약물 순응도 — 약물+CBT 골드스탠다드
8. 긍정심리학 — 감사 실천 효과
9. 수면 위생 — ADHD 70% 수면 문제 동반
10. 자기 인식 — CBT 변화의 시작점
